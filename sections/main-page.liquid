<div class="page-width page-width--narrow page-content">
  {%- render 'breadcrumbs' -%}
  <header class="section-header">
    <h1 class="section-header__title">{{ page.title }}</h1>
  </header>

  {% if page.handle == 'cart-test' %}
    <div class="page-width">
      <div class="mini-cart">
        <header class="mini-cart__header">
          DEIN WARENKORB
        </header>

        <div class="mini-cart__goals">
          <div class="mini-cart__goals-inner">
            <figure class="mini-cart__goals-item">
              <svg fill="#000000" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M 0 6 L 0 8 L 19 8 L 19 23 L 12.84375 23 C 12.398438 21.28125 10.851563 20 9 20 C 7.148438 20 5.601563 21.28125 5.15625 23 L 4 23 L 4 18 L 2 18 L 2 25 L 5.15625 25 C 5.601563 26.71875 7.148438 28 9 28 C 10.851563 28 12.398438 26.71875 12.84375 25 L 21.15625 25 C 21.601563 26.71875 23.148438 28 25 28 C 26.851563 28 28.398438 26.71875 28.84375 25 L 32 25 L 32 16.84375 L 31.9375 16.6875 L 29.9375 10.6875 L 29.71875 10 L 21 10 L 21 6 Z M 1 10 L 1 12 L 10 12 L 10 10 Z M 21 12 L 28.28125 12 L 30 17.125 L 30 23 L 28.84375 23 C 28.398438 21.28125 26.851563 20 25 20 C 23.148438 20 21.601563 21.28125 21.15625 23 L 21 23 Z M 2 14 L 2 16 L 8 16 L 8 14 Z M 9 22 C 10.117188 22 11 22.882813 11 24 C 11 25.117188 10.117188 26 9 26 C 7.882813 26 7 25.117188 7 24 C 7 22.882813 7.882813 22 9 22 Z M 25 22 C 26.117188 22 27 22.882813 27 24 C 27 25.117188 26.117188 26 25 26 C 23.882813 26 23 25.117188 23 24 C 23 22.882813 23.882813 22 25 22 Z"></path></g></svg>
              <figcaption>Free Shipping if amount > <strong>25</strong></figcaption>
            </figure>
            <figure class="mini-cart__goals-item">
              <svg fill="#000000" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M 12 5 C 10.355469 5 9 6.355469 9 8 C 9 8.351563 9.074219 8.683594 9.1875 9 L 4 9 L 4 15 L 5 15 L 5 28 L 27 28 L 27 15 L 28 15 L 28 9 L 22.8125 9 C 22.925781 8.683594 23 8.351563 23 8 C 23 6.355469 21.644531 5 20 5 C 18.25 5 17.0625 6.328125 16.28125 7.4375 C 16.175781 7.585938 16.09375 7.730469 16 7.875 C 15.90625 7.730469 15.824219 7.585938 15.71875 7.4375 C 14.9375 6.328125 13.75 5 12 5 Z M 12 7 C 12.625 7 13.4375 7.671875 14.0625 8.5625 C 14.214844 8.78125 14.191406 8.792969 14.3125 9 L 12 9 C 11.433594 9 11 8.566406 11 8 C 11 7.433594 11.433594 7 12 7 Z M 20 7 C 20.566406 7 21 7.433594 21 8 C 21 8.566406 20.566406 9 20 9 L 17.6875 9 C 17.808594 8.792969 17.785156 8.78125 17.9375 8.5625 C 18.5625 7.671875 19.375 7 20 7 Z M 6 11 L 26 11 L 26 13 L 17 13 L 17 12 L 15 12 L 15 13 L 6 13 Z M 7 15 L 25 15 L 25 26 L 17 26 L 17 16 L 15 16 L 15 26 L 7 26 Z"></path></g></svg>
              <figcaption>Gift 1  if amount => <strong>59</strong></figcaption>
            </figure>
            <figure class="mini-cart__goals-item">
              <svg fill="#000000" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M 9 4 L 9 7.234375 L 5.515625 5.1425781 L 4.484375 6.8574219 L 6.3886719 8 L 3 8 L 3 27 L 9 27 L 9 25 L 5 25 L 5 10 L 13.027344 10 C 13.860344 9.38 14.884 9 16 9 C 16.352 9 16.682 9.0415625 17 9.1015625 L 17 8 L 13.611328 8 L 15.515625 6.8574219 L 14.484375 5.1425781 L 11 7.234375 L 11 4 L 9 4 z M 16 11 C 14.355 11 13 12.355 13 14 C 13 14.352 13.0745 14.684 13.1875 15 L 11 15 L 11 17 L 11 27 L 29 27 L 29 17 L 29 15 L 26.8125 15 C 26.9265 14.684 27 14.352 27 14 C 27 12.355 25.645 11 24 11 C 22.25 11 21.06225 12.3275 20.28125 13.4375 C 20.17625 13.5855 20.093 13.731953 20 13.876953 C 19.906 13.731953 19.82375 13.5865 19.71875 13.4375 C 18.93675 12.3275 17.75 11 16 11 z M 16 13 C 16.625 13 17.4375 13.6715 18.0625 14.5625 C 18.2145 14.7815 18.1915 14.793953 18.3125 15.001953 L 16 15.001953 C 15.434 15.001953 15 14.567953 15 14.001953 C 15 13.435953 15.434 13 16 13 z M 24 13 C 24.566 13 25 13.434 25 14 C 25 14.566 24.566 15 24 15 L 21.6875 15 C 21.8095 14.793 21.7855 14.7805 21.9375 14.5625 C 22.5625 13.6715 23.375 13 24 13 z M 13 17 L 19 17 L 19 25 L 13 25 L 13 17 z M 21 17 L 27 17 L 27 25 L 21 25 L 21 17 z"></path></g></svg>
              <figcaption>Gift 2  if amount => <strong>89</strong></figcaption>
            </figure>
          </div>
          
          <div class="mini-cart__goals-indicator">
            <div class="mini-cart__goals-indicator-stripe"></div>
          </div>
        </div>

        <div class="mini-cart__main">
          product list goes here
        </div>

        <footer class="mini-cart__footer">
          <div class="mini-cart__total">
            <div class="mini-cart__total-label">SUMME</div>
            <div class="mini-cart__total-amount">
              <input type="number" value="1" min="1" step="10" id="amount-input" placeholder="Enter amount for the test">
            </div>
          </div>
        </footer>

        <div class="mini-cart__gifts">
          <div class="mini-cart__gifts-title">BENUTZERGESCHENKE</div>
          <div class="mini-cart__gifts-inner"></div>
        </div>
      </div>
    </div>


    <style>

      .mini-cart {
          max-width: 600px;
          margin-left: auto;
          margin-right: auto;
      }

      .mini-cart__header {
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(0,0,0,.25);
      }

      .mini-cart__footer {
        padding-top: 10px;
        margin-top: 20px;
        border-top: 1px solid rgba(0,0,0,.25);
      }

      .mini-cart__main {
        border-top: 1px solid rgba(0,0,0,.25);
        margin-top: 10px;
        min-height: 300px;
        padding: 25px 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .mini-cart__goals-inner {
        display: flex;
        margin-bottom: 10px;
      }

      .mini-cart__goals-item {
        width: 33.3%;
        text-align: center;
        color: rgba(0,0,0,0.25);
      }

      .mini-cart__goals-item figcaption {
        font-size: 16px;
      }

      .mini-cart__goals-item svg {
        fill: rgba(0,0,0,0.25);
        width: 46px;
        height: auto;
      }

      .mini-cart__goals-item--active {
        color: #008602;
      }

      .mini-cart__goals-item--active svg {
        fill: #008602;
      }

      .mini-cart__goals-indicator {
        border-radius: 3px;
        background-color: rgba(0,0,0,0.25);
      }

      .mini-cart__goals-indicator-stripe {
        height: 6px;
        border-radius: 3px;
        background-color: #008602;
        transition: width ease 500ms;
      }

      .mini-cart__total {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .mini-cart__gifts{
        display: none;
        padding-top: 10px;
        margin-top: 20px;
        border-top: 1px solid rgba(0,0,0,.25);
      }

      .mini-cart__gifts-title {
        text-transform: uppercase;
        margin-bottom: 10px;
      }

      .mini-cart__gifts-inner {
        display: grid;
        grid-gap: 20px;
        grid-template-columns: 1fr 1fr;
      }

      .mini-cart__product {
        margin: 0;
        display: grid;
        grid-gap: 20px;
        grid-template-columns: 120px 1fr;
      }

      .mini-cart__product-title {
        font-size: 10px;
      }

      .mini-cart__product-price {
        color: green;
      }

      .mini-cart__product-img img {
        max-width: 100%;
      }
    </style>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/shopify-cartjs/1.1.0/cart.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script>
      $(document).ready(function () {

        CartJS.init({{ cart | json }});
        let cartUpdated = false;

        const breakpoints = [
          { threshold: 25 },
          { threshold: 59, variantId: 40045540180022, isAdded: false },
          { threshold: 89, variantId: 39686772490294, isAdded: false }
        ];
        const stripeIndicator = $(".mini-cart__goals-indicator-stripe");
        const amount = $("#amount-input");
        const goals = $(".mini-cart__goals-inner");
        const giftsWrap = $(".mini-cart__gifts");
        const gifts = $(".mini-cart__gifts-inner");

        $(document).on('cart.requestComplete', function(event, cart) {
          if (cart.items.length) {
            giftsWrap.fadeIn();

            gifts.html('');

            cart.items.forEach((item) => {
              gifts.append(`
                <figure class="mini-cart__product">
                  <div class="mini-cart__product-img"><img src="${item.image}" alt=""></div>
                  <figcaption class="mini-cart__product-caption">
                    <h4 class="mini-cart__product-title">${item.title}</h4>
                    <div class="mini-cart__product-price">Free</div>
                  </figcaption>
                </figure>
              `);
            })

          } else {
            giftsWrap.hide();
          }
        });

        function removeItem(id) {
          const inTheCart = CartJS.cart.items.find(item => item.id === id);

          if (inTheCart) {
            CartJS.removeItemById(id, {
              "success": function (data, textStatus, jqXHR) {

              },
              "error": function (jqXHR, textStatus, errorThrown) {
                console.log(textStatus);
              }
            });
          }
        }

        function addItem(id) {
          const inTheCart = CartJS.cart.items.find(item => item.variant_id === id);

          if (!id && !inTheCart) return;

          CartJS.addItem(id, {
            "success": function (data, textStatus, jqXHR) {

            },
            "error": function (jqXHR, textStatus, errorThrown) {
              console.log(errorThrown);
            }
          });
        }

        function updateCartBasedOnAmount() {
          const inputValue = parseFloat($("#amount-input").val());

          breakpoints.forEach(breakpoint => {
            if (inputValue >= breakpoint.threshold) {
              addItem(breakpoint.variantId);
            } else if (inputValue < breakpoint.threshold) {
              removeItem(breakpoint.variantId);
            }
          });
        }

        function setIndicatorWidth() {
          const inputValue = parseFloat($("#amount-input").val());

          updateCartBasedOnAmount();

          // Если значение инпута не является числом или NaN, устанавливаем ширину индикатора в 0%
          if (isNaN(inputValue)) {
            stripeIndicator.css('width', '0%');
            return;
          }

          const maxThreshold = Math.max(...breakpoints.map(breakpoint => breakpoint.threshold));

          const widthPercentage = Math.min(100, (inputValue / maxThreshold) * 100);

          stripeIndicator.css('width', widthPercentage + '%');


          for (let i = 0; i < breakpoints.length; i++) {
            if (inputValue >= breakpoints[i].threshold) {
              goals.find('.mini-cart__goals-item').eq(i).addClass('mini-cart__goals-item--active');

            } else {
              goals.find('.mini-cart__goals-item').eq(i).removeClass('mini-cart__goals-item--active');
            }
          }
        }

        amount.on('change', setIndicatorWidth);

        setIndicatorWidth()

      })
    </script>
  {% endif %}

  <div class="rte rte--nomargin">
    {{ page.content }}
  </div>
</div>

{% schema %}
{
  "name": "t:sections.main-page.name",
  "tag": "section"
}
{% endschema %}
