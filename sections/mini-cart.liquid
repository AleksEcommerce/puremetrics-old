
<div class="page-width">
    <div class="mini-cart">

        <div class="mini-cart__inner">
            <header class="mini-cart__header">
                <div class="mini-cart__header-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M4.153 4L6.01 15.146a.993.993 0 0 0 .327.603.997.997 0 0 0 .679.251H18a1 1 0 0 0 .949-.684l3-9A1 1 0 0 0 21 5H6.347L5.99 2.85a.993.993 0 0 0-.357-.625A.998.998 0 0 0 4.984 2H3a1 1 0 0 0 0 2h1.153zm3.694 10L6.68 7h12.933l-2.334 7H7.847zM10 20a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm9 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0z" fill="#0D0D0D"></path></g></svg>
                </div>
                <div class="mini-cart__header-title">{{ section.settings.title }}</div>
                <div type="button" class="mini-cart__header-btn js-cart-toggle">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M5.293 5.293a1 1 0 0 1 1.414 0L12 10.586l5.293-5.293a1 1 0 1 1 1.414 1.414L13.414 12l5.293 5.293a1 1 0 0 1-1.414 1.414L12 13.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L10.586 12 5.293 6.707a1 1 0 0 1 0-1.414z" fill="#0D0D0D"></path></g></svg>
                </div>
            </header>

            <div class="mini-cart__banner">
                <div class="mini-cart__banner-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 66 82.5" style="enable-background:new 0 0 66 66;" xml:space="preserve"><path d="M5.42,41.7c1.13,0,2.21-0.32,3.15-0.92c0.01,0,0.01-0.01,0.02-0.01c0.35-0.22,0.67-0.48,0.97-0.78  c0.74-0.74,1.72-1.14,2.76-1.14c1.04,0,2.02,0.41,2.76,1.14c2.28,2.28,5.99,2.28,8.27,0c0.74-0.74,1.72-1.14,2.76-1.14  c1.04,0,2.02,0.41,2.76,1.14c2.28,2.28,5.99,2.28,8.27,0c0.74-0.74,1.72-1.14,2.76-1.14s2.02,0.41,2.76,1.14  c1.1,1.1,2.57,1.71,4.13,1.71s3.03-0.61,4.13-1.71c1.52-1.52,4-1.52,5.52,0c0.56,0.56,1.22,0.99,1.93,1.28c0,0,0.01,0,0.01,0  c0.69,0.28,1.43,0.42,2.19,0.42c1.56,0,3.03-0.61,4.13-1.71c0.38-0.38,0.38-0.99,0-1.37c-0.38-0.38-0.99-0.38-1.37,0  c-0.74,0.74-1.72,1.14-2.76,1.14c-0.27,0-0.53-0.03-0.79-0.08l0.3-7.7c3.08-9.42-1.96-12.32-4.11-13.56c-0.01,0-0.02-0.01-0.02-0.01  l0.03-1c0.76-0.24,1.33-0.94,1.36-1.78l0.1-3.17c0.03-1.07-0.81-1.96-1.88-2l-6-0.19c-0.55-0.01-1.01,0.17-1.39,0.52  c-0.38,0.36-0.59,0.84-0.61,1.35l-0.1,3.17c-0.02,0.52,0.17,1.01,0.52,1.39c0.2,0.22,0.45,0.37,0.72,0.48l-0.03,1  c-0.01,0.01-0.02,0.01-0.03,0.02c-2.22,1.1-7.41,3.68-4.94,13.27l-0.21,6.68c-1.02-0.8-2.28-1.24-3.6-1.24  c-1.56,0-3.03,0.61-4.13,1.71c-1.52,1.52-4,1.52-5.52,0c-0.99-1-2.26-1.53-3.57-1.66l3.09-6.27c6.68-7.31,3.3-12.03,1.84-14.05  c-0.01-0.01-0.01-0.02-0.02-0.02l0.44-0.9c0.08,0.01,0.16,0.03,0.24,0.03c0.21,0,0.42-0.03,0.63-0.1c0.49-0.17,0.89-0.52,1.11-0.98  l1.4-2.85c0.47-0.96,0.07-2.12-0.89-2.6l-5.39-2.65c-0.96-0.47-2.12-0.07-2.6,0.88c0,0,0,0,0,0l-1.4,2.84  c-0.23,0.46-0.26,0.99-0.1,1.48c0.1,0.28,0.26,0.53,0.46,0.74l-0.44,0.9c0,0-0.01,0-0.01,0c-2.49,0.08-8.3,0.26-10.01,10.05  L7.33,39.24c-0.58,0.33-1.23,0.52-1.92,0.52c-1.04,0-2.02-0.41-2.76-1.14c-0.38-0.38-0.99-0.38-1.37,0c-0.38,0.38-0.38,0.99,0,1.37  C2.39,41.09,3.86,41.7,5.42,41.7z M57.82,38.62c-2.28-2.28-5.99-2.28-8.27,0c-0.74,0.74-1.72,1.14-2.76,1.14  c-0.49,0-0.96-0.1-1.4-0.27l0.22-7.14l12.5,0.39l-0.23,5.93C57.87,38.66,57.84,38.64,57.82,38.62z M49.5,12.21l6,0.19l-0.1,3.17  l-6-0.19L49.5,12.21z M49.51,19.94c0.22-0.11,0.42-0.21,0.59-0.3c0.3-0.16,0.49-0.48,0.5-0.82l0.05-1.46l3.39,0.11L54,18.92  c-0.01,0.35,0.16,0.67,0.45,0.85c0.16,0.1,0.35,0.21,0.56,0.33c1.99,1.14,5.62,3.26,3.4,10.72l-12.95-0.41  C43.71,22.84,47.46,20.95,49.51,19.94z M21.97,38.62c-0.74,0.74-1.72,1.14-2.76,1.14s-2.02-0.41-2.76-1.14  c-1.1-1.1-2.57-1.71-4.13-1.71c-0.63,0-1.24,0.1-1.82,0.29l5.93-12.14l11.23,5.52l-3.25,6.61C23.51,37.46,22.67,37.92,21.97,38.62z   M28.28,8.31l5.39,2.65l-1.4,2.85l-0.3-0.15c0,0,0,0-0.01-0.01l-3.08-1.51l-2.01-0.99L28.28,8.31z M25.12,15.36  c0.23-0.01,0.44-0.01,0.63-0.03c0.34-0.02,0.65-0.23,0.8-0.54l0.65-1.31l3.04,1.49l-0.65,1.31c-0.15,0.31-0.13,0.68,0.06,0.96  c0.11,0.16,0.23,0.34,0.37,0.53c1.34,1.86,3.77,5.29-1.32,11.16l-11.63-5.72C18.62,15.59,22.82,15.43,25.12,15.36z"/><path d="M49.55,47.58c-1.52,1.52-4,1.52-5.52,0c-1.1-1.1-2.57-1.71-4.13-1.71s-3.03,0.61-4.13,1.71c-1.52,1.52-4,1.52-5.52,0  c-2.28-2.28-5.99-2.28-8.27,0c-1.52,1.52-4,1.52-5.52,0c-1.1-1.1-2.57-1.71-4.13-1.71c-1.56,0-3.03,0.61-4.13,1.71  c-0.38,0.38-0.38,0.99,0,1.37c0.38,0.38,0.99,0.38,1.37,0c0.74-0.74,1.72-1.14,2.76-1.14c1.04,0,2.02,0.41,2.76,1.14  c2.28,2.28,5.99,2.28,8.27,0c1.52-1.52,4-1.52,5.52,0c2.28,2.28,5.99,2.28,8.27,0c1.52-1.52,4-1.52,5.52,0  c1.1,1.1,2.57,1.71,4.13,1.71s3.03-0.61,4.13-1.71c1.52-1.52,4-1.52,5.52,0c0.38,0.38,0.99,0.38,1.37,0c0.38-0.38,0.38-0.99,0-1.37  C55.54,45.3,51.83,45.3,49.55,47.58z"/><path d="M63.34,56.54c-0.74,0.74-1.72,1.14-2.76,1.14s-2.02-0.41-2.76-1.14c-2.28-2.28-5.99-2.28-8.27,0  c-0.74,0.74-1.72,1.14-2.76,1.14s-2.02-0.41-2.76-1.14c-1.1-1.1-2.57-1.71-4.13-1.71s-3.03,0.61-4.13,1.71c-1.52,1.52-4,1.52-5.52,0  c-2.28-2.28-5.99-2.28-8.27,0c-0.74,0.74-1.72,1.14-2.76,1.14s-2.02-0.41-2.76-1.14c-1.1-1.1-2.57-1.71-4.13-1.71  c-1.56,0-3.03,0.61-4.13,1.71c-0.74,0.74-1.72,1.14-2.76,1.14s-2.02-0.41-2.76-1.14c-0.38-0.38-0.99-0.38-1.37,0  c-0.38,0.38-0.38,0.99,0,1.37c2.28,2.28,5.99,2.28,8.27,0c0.74-0.74,1.72-1.14,2.76-1.14c1.04,0,2.02,0.41,2.76,1.14  c2.28,2.28,5.99,2.28,8.27,0c1.52-1.52,4-1.52,5.52,0c2.28,2.28,5.99,2.28,8.27,0c1.52-1.52,4-1.52,5.52,0  c1.1,1.1,2.57,1.71,4.13,1.71s3.03-0.61,4.13-1.71c1.52-1.52,4-1.52,5.52,0c2.28,2.28,5.99,2.28,8.27,0c0.38-0.38,0.38-0.99,0-1.37  C64.34,56.16,63.72,56.16,63.34,56.54z"/></svg>
                </div>
                <div class="mini-cart__banner-caption">
                    {{ section.settings.plastic_title }}
                </div>
            </div>

            <div class="mini-cart__goals">
                <div class="mini-cart__goals-inner"></div>
            </div>

            <div class="mini-cart__main">
                <div class="mini-cart__goals-target-caption"></div>

                <div class="mini-cart__products" id="cart-products"></div>
            </div>
        </div>

        <footer class="mini-cart__footer">
            <div class="mini-cart__total">
                <div class="mini-cart__total-label">SUMME</div>
                <div class="mini-cart__total-amount"><span id="cart-amount"></span></div>
            </div>

            <a href="/checkout" class="mini-cart__cta-btn btn">Zur Kasse</a>

            <a href="#" class="mini-cart__cta-link js-cart-toggle">Weiter Shoppen</a>
        </footer>
    </div>
</div>

<template id="cart-item-template">
    <div class="mini-cart__product">
        <a href="#" class="mini-cart__product-img"></a>
        <div class="mini-cart__product-caption">
            <div class="mini-cart__product-name"><a href="#"></a></div>

            <small class="mini-cart__product-properties"></small>

            <div class="mini-cart__product-footer">
                <div class="mini-cart__product-footer-item">
                    <div class="mini-cart__product-price"></div>
                    <div class="mini-cart__product-qty">
                        <div class="mini-cart__product-qty-btn mini-cart__product-qty-btn--minus"></div>
                        <input type="number" min="1" value="1" class="mini-cart__product-qty-inp">
                        <div class="mini-cart__product-qty-btn mini-cart__product-qty-btn--plus"></div>
                    </div>
                </div>
                <div class="mini-cart__product-footer-item">
                    <button type="button" data-variant-id class="mini-cart__product-delete js-remove-cart-line">ENTFERNEN</button>
                </div>
            </div>

        </div>
    </div>
</template>

<template id="cart-gift-item-template">
    <div class="mini-cart__product">
        <a href="#" class="mini-cart__product-img"></a>
        <div class="mini-cart__product-caption">
            <div class="mini-cart__product-name"><a href="#"></a></div>
            <div class="mini-cart__product-price"></div>
        </div>
    </div>
</template>


<div class="mini-cart-overlay"></div>

<style>
    .product-single__form {
        display: none !important;
    }

    .mini-cart-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        z-index: 998;
        background-color: #000;
        visibility: hidden;
        opacity: 0;
    }

    body.nav-active {
        overflow: hidden;
    }

    .nav-active .mini-cart-overlay {
        transition: opacity ease 600ms;
        opacity: 0.5;
        visibility: visible;
    }

    .js-drawer-open [id*='trustbadge-container'],
    .nav-active [id*='trustbadge-container'],
    .nav-active #bixgrow_referral_widget_container{
        display: none !important;
    }

    .nav-active .mini-cart {
        right: 0;
        transition: right ease 400ms;
    }

    .mini-cart {
        transition: right linear 400ms;
        width: 490px;
        max-width: 100%;
        position: fixed;
        top: 0;
        right: -100%;
        height: 100%;
        min-height: 100%;
        z-index: 999;
        background-color: #fff;
        box-shadow: -5px 0 10px rgba(0,0,0,.15);
    }

    .mini-cart__inner {
        max-height: calc(100% - 160px);
        overflow: auto;
        padding: 0 15px;
    }

    .mini-cart__banner {
        background-color: #DBE5F8;
        height: 60px;
        display: flex;
        align-items: center;
        padding: 0 20px;
        grid-gap: 20px;
        line-height: 1.23;
        font-weight: 500;
        color: #557EB8;
        font-size: 14px;
        margin-top: 10px;
    }

    .mini-cart--empty .mini-cart__banner{
        display: none;
    }

    .mini-cart__banner-caption p:last-child {
        margin-bottom: 0;
    }

    .mini-cart__banner-icon{
        background-color: #557EB8;
        width: 70px;
        height: 70px;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
        flex-shrink: 0;
    }

    .mini-cart__banner-icon svg{
        max-width: 60px;
        height: 60px;
        margin-bottom: -5px;
    }

    .mini-cart__banner-icon svg path {
        fill: #fff;
    }

    .mini-cart__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 0;
    }

    .mini-cart--empty .mini-cart__header {
        border-bottom: 1px solid rgba(0, 0, 0, .15);
    }

    .mini-cart__header svg {
        width: 25px;
        height: 25px;
        display: block;
        margin-bottom: -3px;
    }

    .mini-cart__header g,
    .mini-cart__header path {
        fill: rgba(0,0,0,.35);
        transition: fill ease 150ms;
    }

    .mini-cart__header-btn:hover {
        cursor: pointer;
    }

    .mini-cart__header-btn:hover g,
    .mini-cart__header-btn:hover path{
        fill: rgba(0,0,0,.7);
    }

    .mini-cart__header-title {
        font-weight: 700;
    }

    .mini-cart__footer {
        text-align: center;
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 0 15px 15px;
        background-color: #fff;
        z-index: 10;
    }

    .mini-cart__footer::before {
        display: block;
        position: absolute;
        bottom: 100%;
        left: 0;
        width: 100%;
        height: 20px;
        background: linear-gradient(to bottom,  rgba(255,255,255,0) 0%,rgba(255,255,255,1) 100%);
        content: '';
    }

    .mini-cart__main {
        border-top: 1px solid rgba(0,0,0,.15);
        /*padding-right: 15px;*/
        /*overflow: auto;*/
        /*height: calc(100% - 435px);*/
    }

    .mini-cart__goals-inner {
        display: grid;
        grid-gap: 15px;
        padding: 20px 0 10px;
        grid-template-columns: 1fr 1fr 1fr;
    }

    .mini-cart__goals-item {
        margin: 0;
        text-align: center;
        color: rgba(0,0,0,0.25);
        display: flex;
        flex-direction: column;
        grid-gap: 10px;
        color: #008602;
        font-weight: 500;
    }

    .mini-cart__goals-item figcaption {
        font-size: 14px;
        padding: 0 10px;
    }

    .mini-cart__goals-item svg {
        fill: rgba(0,0,0,0.25);
        width: 26px;
        height: auto;
    }

    .mini-cart__goals-icon {
        margin-left: auto;
        margin-right: auto;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        border: 1px solid rgba(0,0,0,.15);
        position: relative;
    }

    .mini-cart__goals-icon[data-label] {
        flex-direction: column;
    }

    .mini-cart__goals-icon[data-label]::before {
        content: attr(data-label);
        display: block;
        font-size: 11px;
        line-height: 11px;
    }

    .mini-cart__goals-icon img {
        max-width: 100%;
        height: auto;
        border-radius: 50%;
    }

    .mini-cart__goals-target-caption {
        text-align: center;
        color: #ff1365;
        padding: 10px 0;
        border-bottom: 1px solid rgba(0,0,0,.15);
        font-weight: 500;
    }

    .mini-cart__goals-target-caption:empty {
        display: none;
    }

    .mini-cart__goals-target-caption span {
        font-weight: 700;
    }

    .mini-cart__goals-item--active .mini-cart__goals-icon::after {
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 24 24' id='Layer_1' data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' fill='%23008602'%3E%3Cg id='SVGRepo_bgCarrier' stroke-width='0'%3E%3C/g%3E%3Cg id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'%3E%3C/g%3E%3Cg id='SVGRepo_iconCarrier'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:none;stroke:%23008602;stroke-miterlimit:10;stroke-width:1.91px;%7D%3C/style%3E%3C/defs%3E%3Ccircle class='cls-1' cx='12' cy='12' r='10.5'%3E%3C/circle%3E%3Cpolyline class='cls-1' points='6.27 12 10.09 15.82 17.73 8.18'%3E%3C/polyline%3E%3C/g%3E%3C/svg%3E");
        position: absolute;
        display: block;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: 50%;
        background-color: white;
        width: 20px;
        height: 20px;
        top: 67%;
        right: -4px;
        content: '';
        z-index: 20;
        border-radius: 50%;
    }

    .mini-cart__goals-item--active .mini-cart__goals-icon {
        border-color: #008602;
    }

    .mini-cart__goals-item--active svg {
        fill: #008602;
    }

    .mini-cart__goals-indicator {
        background-color: rgba(0,0,0,0.25);
        position: relative;
        border-radius: 3px;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type=number] {
        -moz-appearance: textfield;
    }

    .mini-cart__goals-indicator-stripe {
        height: 6px;
        width: 0;
        background-color: #008602;
        border-radius: 3px;
        transition: width ease 500ms;
    }

    .mini-cart__total {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .mini-cart__gifts{
        display: none;
        padding-top: 10px;
        margin-top: 20px;
        border-top: 1px solid rgba(0,0,0,.15);
    }

    .mini-cart__gifts-title {
        text-transform: uppercase;
        margin-bottom: 10px;
    }

    .mini-cart__gifts-inner {
        display: grid;
        grid-gap: 20px;
        grid-template-columns: 1fr 1fr;
    }

    .mini-cart__product {
        margin: 0;
        display: grid;
        grid-gap: 20px;
        grid-template-columns: 90px 1fr;
        border-bottom: 1px solid rgba(0,0,0,.15);
        padding: 20px 0;
    }

    .mini-cart__product-properties:empty {
        display: none;
    }

    .mini-cart__product:last-child {
        border: 0;
    }

    .mini-cart__product--gift .mini-cart__product-price::before {
        display: block;
        content: 'GRATIS';
        background-image: url("data:image/svg+xml,%3Csvg width='64px' height='64px' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cg id='SVGRepo_bgCarrier' stroke-width='0'%3E%3C/g%3E%3Cg id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'%3E%3C/g%3E%3Cg id='SVGRepo_iconCarrier'%3E%3Cpath d='M19.5 7.75H18.1C18.5 7.27 18.75 6.67 18.75 6C18.75 4.48 17.52 3.25 16 3.25C14.32 3.25 12.84 4.14 12 5.46C11.16 4.14 9.68 3.25 8 3.25C6.48 3.25 5.25 4.48 5.25 6C5.25 6.67 5.5 7.27 5.9 7.75H4.5C3.81 7.75 3.25 8.31 3.25 9V11.5C3.25 12.1 3.68 12.58 4.25 12.7V19.5C4.25 20.19 4.81 20.75 5.5 20.75H18.5C19.19 20.75 19.75 20.19 19.75 19.5V12.7C20.32 12.58 20.75 12.1 20.75 11.5V9C20.75 8.31 20.19 7.75 19.5 7.75ZM19.25 11.25H12.75V9.25H19.25V11.25ZM16 4.75C16.69 4.75 17.25 5.31 17.25 6C17.25 6.69 16.69 7.25 16 7.25H12.84C13.18 5.82 14.47 4.75 16 4.75ZM8 4.75C9.53 4.75 10.82 5.82 11.16 7.25H8C7.31 7.25 6.75 6.69 6.75 6C6.75 5.31 7.31 4.75 8 4.75ZM4.75 9.25H11.25V11.25H4.75V9.25ZM5.75 12.75H11.25V19.25H5.75V12.75ZM18.25 19.25H12.75V12.75H18.25V19.25Z' fill='%2300861A'%3E%3C/path%3E%3C/g%3E%3C/svg%3E");
        background-size: 20px auto;
        background-repeat: no-repeat;
        background-position: 0 50%;
        padding: 0 0 0 25px;
        margin-bottom: 5px;
        color: #00861A;
        text-decoration: initial !important;
    }

    .mini-cart__product--gift .mini-cart__product-price::after{
        text-decoration: line-through;
        color: rgba(0,0,0,.35);
        content: attr(data-compare-price);
    }

    .mini-cart__product--gift .mini-cart__product-caption {
        justify-content: center;
        grid-gap: 10px;
    }

    .mini-cart__product-title {
        font-size: 10px;
    }

    .mini-cart__product-price {
        font-size: 14px;
        font-weight: 500;
        white-space: nowrap;
    }
    .mini-cart__product-price {
        display: inline-flex;
        grid-gap: 0.6rem;
    }

    .mini-cart__product-price[data-sale]::before {
         content: attr(data-sale);
         display: inline-block;
         font-weight: 400;
         opacity: 0.25;
         text-decoration: line-through;
    }

    .mini-cart__product-img {
        width: 90px;
        height: 90px;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: 50%;
        border-radius: 8px;
    }

    .mini-cart__product-img img {
        max-width: 100%;
    }

    .mini-cart__product-name {
        font-size: 16px;
        font-weight: 500;
    }

    .mini-cart__product-qty {
        margin-top: 5px;
        position: relative;
        max-width: 76px;
        display: flex;
        align-items: center;
        border-radius: 4px;
        border: 1px solid rgba(0,0,0,.15);
    }

    .mini-cart__product-qty-inp {
         width: 100%;
         text-align: center;
         font-size: 14px;
         padding: 0;
         height: 26px;
         border: 0;
     }

    .mini-cart__product-qty-btn {
        display: block;
        flex-shrink: 0;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background-repeat: no-repeat;
        background-position: 50%;
        background-size: 10px auto;
        cursor: pointer;
    }

    .mini-cart__product-qty-btn--minus {
         left: 0;
         background-image: url("data:image/svg+xml,%3Csvg width='12' height='2' viewBox='0 0 12 2' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 1L-5.36442e-07 0.999999' stroke='%23202020'/%3E%3C/svg%3E%0A");
     }

    .mini-cart__product-qty-btn--plus {
         right: 0;
         background-image: url("data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 12 12' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M6 0V12' stroke='%23202020'/%3E%3Cpath d='M12 6L-5.36442e-07 6' stroke='%23202020'/%3E%3C/svg%3E%0A");
    }

    .mini-cart__product-footer {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
    }

    @media screen and (min-width: 430px) {
        .mini-cart__product-footer-item{
            display: flex;
            align-items: flex-end;
            flex-direction: row-reverse;
            grid-gap: 15px;
        }
    }

    .mini-cart__product-delete {
        background-image: url("data:image/svg+xml,%3Csvg width='64px' height='64px' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cg id='SVGRepo_bgCarrier' stroke-width='0'%3E%3C/g%3E%3Cg id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'%3E%3C/g%3E%3Cg id='SVGRepo_iconCarrier'%3E%3Cpath d='M6 7V18C6 19.1046 6.89543 20 8 20H16C17.1046 20 18 19.1046 18 18V7M6 7H5M6 7H8M18 7H19M18 7H16M10 11V16M14 11V16M8 7V5C8 3.89543 8.89543 3 10 3H14C15.1046 3 16 3.89543 16 5V7M8 7H16' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3C/path%3E%3C/g%3E%3C/svg%3E");
        background-size: 18px auto;
        font-size: 14px;
        font-weight: 500;
        padding: 0 0 0 24px;
        background-repeat: no-repeat;
        background-position: 0 50%;
        display: inline-block;
        opacity: .6;
    }

    .mini-cart__product-delete:hover {
        opacity: 1;
    }

    .mini-cart__product-caption {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 10px 0 0;
    }

    .mini-cart__footer {
        padding-bottom: 25px;
    }

    .mini-cart__total {
        font-weight: 600;
        padding: 10px 0;
    }

    .mini-cart__total-label {
        font-weight: 500;
    }

    .mini-cart__cta-btn {
        background-color: #008602;
        line-height: 42px;
        display: block;
        color: #fff;
        font-weight: 700;
        text-align: center;
        margin-bottom: 10px;
    }

    .mini-cart__cta-link {
        font-size: 16px;
        font-weight: 500;
        display: inline-block;
        opacity: .6;
    }

    .mini-cart__cta-link:hover {
        opacity: 1;
    }

    .mini-cart__products:empty {
        margin-right: -15px;
        display: flex;
        flex-direction: column;
        width: 100%;
        grid-gap: 10px;
        align-items: center;
        justify-content: center;
        opacity: .35;
        padding: 25px 0;
        height: calc(100vh - 430px);
        min-height: 150px;
    }

    .mini-cart__products:empty::before {
        background-image: url("data:image/svg+xml,%3Csvg width='64px' height='64px' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cg id='SVGRepo_bgCarrier' stroke-width='0'%3E%3C/g%3E%3Cg id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'%3E%3C/g%3E%3Cg id='SVGRepo_iconCarrier'%3E%3Cpath d='M6.29977 5H21L19 12H7.37671M20 16H8L6 3H3M9 20C9 20.5523 8.55228 21 8 21C7.44772 21 7 20.5523 7 20C7 19.4477 7.44772 19 8 19C8.55228 19 9 19.4477 9 20ZM20 20C20 20.5523 19.5523 21 19 21C18.4477 21 18 20.5523 18 20C18 19.4477 18.4477 19 19 19C19.5523 19 20 19.4477 20 20Z' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3C/path%3E%3C/g%3E%3C/svg%3E");
        width: 58px;
        height: 58px;
        background-repeat: no-repeat;
        background-size: cover;
        background-position: 50%;
        display: block;
        content: '';
    }

    .mini-cart__products:empty::after {
        font-size: 16px;
        font-weight: 500;
        content: 'Dein Warenkorb ist noch leer.';
    }

    #upside-ucd-cart-drawer {
        display: none !important;
    }

    @media screen and (max-width: 767px) {

        .mini-cart__banner {
            padding: 0 10px;
            grid-gap: 15px;
            font-size: 12px;
        }

        .mini-cart__banner-icon {
            width: 50px;
            height: 50px;
        }

        .mini-cart__banner-icon svg {
            width: 40px;
            height: 40px;
        }

        .mini-cart__banner {
            height: 42px;
        }

        .mini-cart__goals-item figcaption {
            font-size: 12px;
            padding: 0;
        }

        .mini-cart__goals-item {
            grid-gap: 8px;
        }

        .mini-cart__goals-indicator-stripe {
            height: 4px;
        }

        /*.mini-cart__main {*/
        /*    height: calc(100% - 406px);*/
        /*}*/

        /*.mini-cart__goals-target-caption {*/
        /*    display: none !important;*/
        /*}*/
    }
</style>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/shopify-cartjs/1.1.0/cart.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script>

    function addCommas(number) {
        const parts = parseFloat(number).toFixed(2).toString().split(".");

        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, " ");

        return parts.join(",") + ' ' + Shopify.currency.active;
    }


    function cartToggle() {
        const body = $('body');
        if (body.hasClass('nav-active')) {
            body.removeClass('nav-active');
        } else {
            body.addClass('nav-active');
        }
    }

    $(document).ready(function () {

        CartJS.init({{ cart | json }});

        // console.log(CartJS.cart.attributes);

        $(".js-cart-toggle").on('click', (e) => {
            e.preventDefault();
            cartToggle();
        });

        $(".mini-cart-overlay").on('click', cartToggle);

        $("body").on('click', '.js-add-to-cart', (e) => {
            e.preventDefault();
            const url = window.location.href;
            const match = url.match(/[?&]variant=([^&]*)/);
            const sellingPlan = url.match(/[?&]selling_plan=([^&]*)/);

            const currentBtn = $(e.currentTarget);
            const variantID = match ? match[1] : currentBtn.data('variant-id');
            const sellingPlanId = sellingPlan ? sellingPlan[1] : false;

            const qty = currentBtn.closest('.page-content--product').find('.js-qty__num') ? currentBtn.closest('.page-content--product').find('.js-qty__num').val() : false;

            addItem(variantID, qty, sellingPlanId);
        })

        const targetCaption = $(".mini-cart__goals-target-caption");
        const goals = $(".mini-cart__goals-inner");
        const cartContent = $('#cart-products');
        let gifts = [];

        function addOrRemoveValue(value) {
            let index = gifts.indexOf(value);

            if (index === -1) {
                gifts.push(value);
            } else {
                gifts.splice(index, 1);
            }
        }



        const breakpoints = [
            {%- for item in section.blocks -%}
                {%- assign giftProduct = item.settings.gift_product -%}
                {%- assign giftVariant = giftProduct.selected_or_first_available_variant -%}
                {
                    threshold: parseFloat({{ item.settings.treshhold }} * Shopify.currency.rate).toFixed(2),
                    title: `{{ item.settings.title }}`,
                    {% if giftVariant.id %}
                    variantId: '{{ giftVariant.id }}',
                    image: '{{ giftProduct.featured_image.src | image_url: width: '400' }}',
                    url: `{{ giftProduct.url }}`,
                    productTitle: `{{ giftProduct.title }}`,
                    price: '{{ giftVariant.price | money_without_currency }}',
                    notification: `Dir fehlen nur noch <span></span> zum GRATIS "{{ giftProduct.title }}"`
                    {% else %}
                    icon: `{{ item.settings.icon }}`,
                    notification: `Dir fehlen nur noch <span></span> zum "{{ item.settings.title }}"`
                    {% endif %}
                },
            {%- endfor -%}
        ];

        if (breakpoints.length) {
            breakpoints.forEach((breakpoint) => {
                goals.append(`
                    <figure class="mini-cart__goals-item">
                        <div class="mini-cart__goals-icon" ${breakpoint.icon ? `data-label='${breakpoint.title}'` : ''}>
                            ${ breakpoint.variantId ? `<img src="${breakpoint.image}" alt="">` : `${breakpoint.icon}`}
                        </div>

                        <div class="mini-cart__goals-indicator">
                            <div class="mini-cart__goals-indicator-stripe"></div>
                        </div>

                        <figcaption class="mini-cart__goals-item-caption">${breakpoint.title} <div>ab <span>${addCommas(breakpoint.threshold)}</span></div> </figcaption>
                    </figure>
                `);
            })
        }


        const maxThreshold = breakpoints.reduce((max, current) => {
            return Math.max(max, current.threshold);
        }, -Infinity);

        function updateItem(index, qty) {
            if (!index && !qty) return;
            CartJS.updateItemById(index, qty);
        }

        let timeout;
        cartContent.on('change', '.mini-cart__product-qty', (e) => {
            const currenInp = $(e.target);
            const currentLine = currenInp.closest('.mini-cart__product').data('variant-id');
            const newVal = currenInp.val();

            clearTimeout(timeout);

            timeout = setTimeout(function() {
                updateItem(currentLine, +newVal);
            }, 500);
        })

        function cartItem(item, index) {
            if (!parseInt(item.line_price) > 0) return;
            const cartItemTemplate = document.getElementById('cart-item-template');
            const templateClone = cartItemTemplate.content.cloneNode(true);

            let cartItem = templateClone.querySelector('.mini-cart__product');
            cartItem = $(cartItem);
            const productName = cartItem.find('.mini-cart__product-name a');
            const productImg = cartItem.find('.mini-cart__product-img');
            const productPrice = cartItem.find('.mini-cart__product-price');
            const qtyInp = cartItem.find('.mini-cart__product-qty-inp');
            const productTitle = item.title.replace(/&#(\d+);/g, function(match, dec) {
                return String.fromCharCode(dec);
            });
            const sellingPlan = item.selling_plan_allocation;

            let comparePrice = item.original_line_price > item.line_price ? item.original_line_price : false;

            const removeBtn = cartItem.find('.js-remove-cart-line');

            if (sellingPlan && sellingPlan.compare_at_price > sellingPlan.price) {
                comparePrice = sellingPlan.compare_at_price;
                cartItem.find('.mini-cart__product-properties').text(sellingPlan.selling_plan.name)
            }

            cartItem.addClass(`mini-cart__product--${item.product_type.toLowerCase()}`);

            cartItem.attr('data-variant-id', item.variant_id);

            productImg.css('background-image', `url(${item.featured_image.url}&width=250)`);
            productImg.attr('href', item.url);
            productName.attr('href', item.url);
            productName.text(productTitle);
            productPrice.text(`${addCommas(item.line_price / 100)}`);

            if (comparePrice) {
                productPrice.attr('data-sale', addCommas(comparePrice / 100));
            }

            cartItem.attr('data-cart-line', index);

            if (item.options_with_values) {
                const productOptions = cartItem.find('.mini-cart__product-options');

                item.options_with_values.forEach((option) => {
                    let label = option.value.split('|');

                    if (label.length > 1) {
                        label = `<div class="mini-cart__product-color" style="background: ${label[1]};"></div>${label[0]}`;
                    }
                    productOptions.append(`<li class="mini-cart__product-option">${option.name}: ${label}</li>`)
                })
            }

            qtyInp.val(item.quantity);

            cartItem.on('click', '.mini-cart__product-qty-btn', (event) => {
                let value = parseInt(qtyInp.val());
                const $this = $(event.currentTarget);

                if ($this.hasClass('mini-cart__product-qty-btn--minus')) {
                    if (value > 1) {
                        value--;
                    }
                } else {
                    value++;
                }

                qtyInp.val(value);

                updateItem(cartItem.attr('data-variant-id'), +qtyInp.val());
            })

            removeBtn.data('variant-id', item.variant_id);

            cartItem.on('click', '.js-remove-cart-line', (event) => {
                const $this = $(event.currentTarget);
                const lineIndex = $this.closest('[data-cart-line]').data('cart-line');
                removeItem($this.data('variant-id'), lineIndex);
            })

            return cartItem;
        }

        function cartGiftItem(item) {
            if(!item.variantId) return;

            const cartItemTemplate = document.getElementById('cart-gift-item-template');
            const templateClone = cartItemTemplate.content.cloneNode(true);

            let cartItem = templateClone.querySelector('.mini-cart__product');
            cartItem = $(cartItem);

            cartItem.hide();
            cartItem.addClass('mini-cart__product--gift');

            const productName = cartItem.find('.mini-cart__product-name a');
            const productImg = cartItem.find('.mini-cart__product-img');
            const productPrice = cartItem.find('.mini-cart__product-price');
            const productTitle = item.productTitle;
            const productUrl = item.url.replace('-gratis', '');

            cartItem.attr('data-variant-id', item.variantId);

            productPrice.attr('data-compare-price', addCommas(item.price));
            productImg.css('background-image', `url(${item.image})`);
            productImg.attr('href', productUrl);
            productName.text(productTitle);
            productName.attr('href', productUrl);
            cartItem.fadeIn();

            return cartItem;
        }

        function renderCart() {
            const cart = CartJS.cart;
            const cartItems = cart.items;

            let index = 1;

            cartContent.find('.mini-cart__product:not(.mini-cart__product--gift)').remove();
            // cartContent.html('');


            cartItems.forEach((item) => {
                if (cartItem(item)) {
                    cartContent.append(cartItem(item, index));
                    ++index;
                }
            })

            setIndicatorWidth();

            $("#cart-amount").text(addCommas(cart.total_price / 100));
        }

        $(document).on('cart.requestComplete', function(event, cart) {
            renderCart(cart);
        });

        renderCart();

        function removeItem(id, index) {
            const inTheCart = CartJS.cart.items.find(item => +item.id === +id);

            if (inTheCart) {
                CartJS.removeItem(index, {
                    "success": function (data, textStatus, jqXHR) {
                        console.log('item removed');
                    },
                    "error": function (jqXHR, textStatus, errorThrown) {
                        console.log(textStatus);
                    }
                });
                // CartJS.removeItemById(id, {
                //     "success": function (data, textStatus, jqXHR) {
                //         console.log('gift removed');
                //     },
                //     "error": function (jqXHR, textStatus, errorThrown) {
                //         console.log(textStatus);
                //     }
                // });
            }
        }

        function addItem(id, qty, sellingPlan) {
            const inTheCart = CartJS.cart.items.find(item => +item.variant_id === +id);
            const properties = {};

            if (!id && !inTheCart) return;

            if(sellingPlan) {
                properties['selling_plan'] = sellingPlan;
            }

            CartJS.addItem(id, qty, properties, {
                "success": function (data, textStatus, jqXHR) {
                    cartToggle();
                },
                "error": function (jqXHR, textStatus, errorThrown) {
                    console.log(errorThrown);
                }
            });
        }

        function addGiftItem(item) {
            const productsList = $("#cart-products");
            const cartItems = CartJS.cart.items
            const inTheCart = cartItems.find(lineItem => +lineItem.id === +item.variantId);

            if (!productsList.find(`.mini-cart__product--gift[data-variant-id="${item.variantId}"]`).length) {
                cartContent.append(cartGiftItem(item));

                if (!inTheCart && item.variantId) {
                    CartJS.addItem(item.variantId, 1, {}, {
                        "success": function (data, textStatus, jqXHR) {
                            console.log('gift added');
                        },
                        "error": function (jqXHR, textStatus, errorThrown) {
                            console.log(errorThrown);
                        }
                    });
                }
            }
        }

        function removeGiftItem(item) {
            const productsList = $("#cart-products");
            const targetEl = productsList.find(`.mini-cart__product--gift[data-variant-id="${item.variantId}"]`);
            const cartItems = CartJS.cart.items
            const inTheCart = cartItems.find(lineItem => +lineItem.id === +item.variantId);

            if (targetEl.length) {
                targetEl.remove();

                if (inTheCart && item.variantId) {
                    CartJS.removeItemById(item.variantId);
                }
            }
        }

        function updateCartBasedOnAmount() {
            const inputValue = parseFloat(CartJS.cart.total_price / 100);
            const cartItems = CartJS.cart.items;

            if (inputValue < 1) {
                $(".mini-cart").addClass('mini-cart--empty');
            } else {
                $(".mini-cart").removeClass('mini-cart--empty');
            }

            breakpoints.forEach(breakpoint => {
                if (inputValue >= breakpoint.threshold) {
                    addGiftItem(breakpoint);

                } else if (inputValue < breakpoint.threshold) {
                    removeGiftItem(breakpoint);
                }
            });
        }

        function getRanges(breakpoints) {
            let ranges = [];

            if (breakpoints.length > 0 && breakpoints[0].threshold > 0) {
                ranges.push({ from: 0, to: breakpoints[0].threshold });
            }

            for (let i = 0; i < breakpoints.length - 1; i++) {
                ranges.push({ from: breakpoints[i].threshold + 1, to: breakpoints[i + 1].threshold });
            }

            return ranges;
        }


        function setIndicatorWidth() {
            const inputValue = parseFloat(CartJS.cart.total_price / 100).toFixed(2);
            // const inputValue = 89.00;
            const ranges = getRanges(breakpoints);

            updateCartBasedOnAmount();

            ranges.forEach((range, index) => {
                const currentValues = range;
                const currentGoal = goals.find(`.mini-cart__goals-item:eq(${index})`);
                const currentStripe = currentGoal.find('.mini-cart__goals-indicator-stripe');
                let stripeWidth = parseInt(currentGoal.find('.mini-cart__goals-indicator-stripe').width());
                const currentAmount = parseFloat(inputValue);
                const currentFrom = parseFloat(currentValues.from);
                const currentTo = parseFloat(currentValues.to);

                if (currentAmount >= currentFrom && currentAmount <= currentTo ) {
                    stripeWidth = currentAmount / currentTo * 100;

                    if (currentAmount < maxThreshold && (currentTo - currentAmount) > 0) {
                        targetCaption.fadeIn();
                        targetCaption.html(breakpoints[index].notification);
                        targetCaption.find('span').text(addCommas(currentTo - currentAmount));
                    } else {
                        targetCaption.hide();
                    }

                } else if(currentAmount < currentFrom){
                    stripeWidth = 0;
                } else if(currentAmount > currentTo){
                    stripeWidth = 100;
                    // targetCaption.hide();
                }

                if (stripeWidth <= 100) {
                    currentStripe.css('width', `${stripeWidth}%`);
                }


                // goals.find('.mini-cart__goals-item--active').removeClass('mini-cart__goals-item--active');

                if (currentAmount >= currentTo) {
                    currentGoal.addClass('mini-cart__goals-item--active');
                } else {
                    currentGoal.removeClass('mini-cart__goals-item--active');
                }
            })

        }

        setIndicatorWidth()

    })
</script>


{% schema %}
{
  "name": "Mini Cart",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "richtext",
      "id": "plastic_title",
      "label": "Plastic title"
    }
  ],
  "blocks": [
    {
      "name": "Gift",
      "type": "gift",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "product",
          "id": "gift_product",
          "label": "Gift Product"
        },
        {
          "type": "number",
          "id": "treshhold",
          "label": "Treshhold"
        }
      ]
    },
    {
      "name": "Free delivery",
      "type": "free_delivery",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "textarea",
          "id": "icon",
          "label": "Icon"
        },
        {
          "type": "number",
          "id": "treshhold",
          "label": "Treshhold"
        }
      ]
    }
  ]
}
{% endschema %}